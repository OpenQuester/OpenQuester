global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: "openquester-api"
    metrics_path: /metrics

    # Bearer token read from file at scrape time.
    # In dev the file is empty — server allows unauthenticated access.
    # In production, place your token in prometheus/bearer_token
    # (must match the METRICS_TOKEN env var on the server).
    authorization:
      type: Bearer
      credentials_file: /etc/prometheus/bearer_token

    static_configs:
      # Each target is a dedicated metrics server port (not the API port).
      # In dev (single instance), only port 9209 is active.
      # In production (PM2 cluster), each instance auto-offsets:
      #   instance 0 → 9209, instance 1 → 9210, instance 2 → 9211, instance 3 → 9212
      # Prometheus gracefully marks unreachable targets as "down" — no errors,
      # no manual editing needed when scaling up or down.
      - targets:
          - "host.docker.internal:9209"
          - "host.docker.internal:9210"
          - "host.docker.internal:9211"
          - "host.docker.internal:9212"
